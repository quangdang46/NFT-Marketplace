Frontend (Next.js)
Hiển thị UI Connect Wallet (Metamask, Coinbase, v.v.).

Người dùng click kết nối ví → gọi Thirdweb để kết nối.

Lấy địa chỉ ví và yêu cầu Backend tạo nonce.

Tạo thông điệp (message) bao gồm nonce và địa chỉ ví.

Ký message với private key của ví.

Gửi địa chỉ ví, message, chữ ký và nonce đến Backend qua API /connect-wallet.

Backend (NestJS)
Nhận request từ Frontend (POST /connect-wallet).

Redis: Kiểm tra nonce có hợp lệ và chưa hết hạn không.

Xác thực chữ ký bằng ethers.js (Ethereum) hoặc @solana/web3.js (Solana).

PostgreSQL: Lưu thông tin người dùng (nếu chưa tồn tại) hoặc cập nhật thông tin.

Tạo JWT token.

Redis: Lưu token vào Redis với thời gian hết hạn.

MongoDB: Ghi log kết nối ví (ví dụ: thời gian, địa chỉ ví, IP).

Lưu token vào cookie và gửi lại Frontend.

Frontend (Next.js)
Nhận token từ Backend, lưu vào cookie.

Dùng token này để gọi API khác trong hệ thống.

Khi ngắt kết nối ví, gửi request /disconnect-wallet, xóa token.